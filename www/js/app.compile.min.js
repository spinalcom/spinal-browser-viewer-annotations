angular.module('app.route',['ngRoute']),angular.module('app.services',[]),angular.module('app.directives',[]),angular.module('app.controllers',[]),angular.module('app.spinalcom',['settings','ngMaterial']),angular.module('app.spinalforge.plugin',[]),angular.module('SpinalApp',['ngAnimate','ngMaterial','app.directives','app.route','app.services','app.controllers','ngMdIcons','settings','app.spinalcom','app.spinalforge.plugin','colorpicker.module']).run(['$rootScope','$location','authService',function(a,b,c){let d=c.get_user();a.$on('$routeChangeStart',function(a,e){e.$$route.authenticate&&!c.is_Connected()&&c.login(d.username,d.password).then(function(){},function(){b.path('/login')})})}]).config(['$mdThemingProvider',function(a){a.theme('altTheme').primaryPalette('grey',{default:'200'}).accentPalette('grey',{default:'700'}).dark(),a.theme('default').dark(),a.setDefaultTheme('altTheme'),a.alwaysWatchTheme(!0)}]).run(['$templateCache','$http',function(a,b){let c=(c,d)=>{b.get(c).then((b)=>{a.put(d,b.data)},()=>{console.log('Cannot load the file '+c)})},d=[{uri:'app/templates/forgeviewer.html',name:'forgeviewer.html'}];for(var e=0;e<d.length;e++)c(d[e].uri,d[e].name)}]);
angular.module('settings',[]).constant('config',{main_path:'/',spinalhub_url:'127.0.0.1',spinalhub_port:'8888',spinalhub_user:'168'});
angular.module("app.route").config(["$routeProvider","$locationProvider",function(a){a.when("/viewer/:filepath",{templateUrl:"app/templates/main.html",authenticate:!0,controller:"mainCtrl"}).when("/login",{templateUrl:"app/templates/login.html",authenticate:!1,controller:"loginCtrl"}).when("/404",{authenticate:!1,controller:["$location",function(a){a.replace("/drive/")}]}).otherwise({redirectTo:"/404"})}]);
angular.module('app.directives').directive('navbar',[function(){return{restrict:'E',templateUrl:'app/templates/navbar.html',controller:'navbarCtrl'}}]).directive('menuGlayout',['goldenLayoutService','$timeout',function(a){return{restrict:'E',scope:{layoutInfo:'=info'},replace:!0,template:'<li ng-repeat="layout in layoutInfo"  id="{{layout.id}}"><a >{{layout.name}}</a></li>',link:(b)=>{a.wait_ready().then(()=>{let c=(a,b)=>()=>{a.createChild(b.cfg)};for(var d=0;d<b.layoutInfo.length;d++){let e=b.layoutInfo[d];a.createDragSource($('#'+e.id)[0],e.cfg),$('#'+e.id).click(c(a,e))}})}}}]).directive('ngRightClick',['$parse',function(a){return function(b,c,d){var e=a(d.ngRightClick);c.bind('contextmenu',function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}]);
angular.module('app.spinalcom').factory('ngSpinalCore',['$q',function(a){var b={};return b.conn=0,b.connect=function(a){b.conn=spinalCore.connect(a)},b.store=function(c,d){var e=a.defer();return spinalCore.store(b.conn,c,d,function(a){e.resolve(a)},function(){e.reject()}),e.promise},b.load=function(c){var d=a.defer();return spinalCore.load(b.conn,c,function(a){d.resolve(a)},function(){d.reject()}),d.promise},b.load_type=function(c,d){var e=a.defer();return spinalCore.load_type(b.conn,c,d,function(a){e.resolve(a)},function(){e.reject()}),e.promise},b.load_right=function(c){var d=a.defer();return spinalCore.load_right(b.conn,c,function(a){d.resolve(a)},function(){d.reject()}),d.promise},b.share_model=function(a,c,d,e){return spinalCore.share_model(b.conn,a,c,d,e)},b}]);
angular.module('app.spinalcom').factory('spinalModelDictionary',['$q','ngSpinalCore','config','authService','$routeParams','$location',function(a,b,c,d,e,f){let g={};return g.model=0,g.init=()=>{var c=a.defer();return 0==g.model?d.wait_connect().then(()=>{let a=d.get_user(),h=e.filepath;console.log(h),h&&(h=atob(h),b.load(h).then((a)=>{g.model=a,console.log(a),c.resolve(a)},()=>{let a='not able to load : '+h;console.error(a),f.replace('/drive/'),c.reject(a)}))},()=>{let a='not able to load : '+path;console.error(a),f.replace('/drive/'),c.reject(a)}):c.resolve(g.model),c.promise},g}]);
angular.module('app.services').factory('goldenLayoutService',['$q','$window','$templateCache','$rootScope','$compile',function(a,b,c,d,e){var f={content:[{type:'row',content:[{isClosable:!1,title:'Viewer',type:'component',componentName:'SpinalHome',componentState:{template:'forgeviewer.html',controller:'forgeViewerCtrl'}}]}]};let g=0,h={};return h.init=()=>{0==g&&(g=new GoldenLayout(f,$('#g-layout')),g.registerComponent('SpinalHome',function(a,b){var f=a.getElement();''==b.template?(f.html(),e(f.contents())(d)):(f.html('<div class="gpannel-content" ng-controller="'+b.controller+'" ng-cloak>'+c.get(b.template)+'</div>'),e(f.contents())(d))}),g.init(),angular.element(b).bind('resize',function(){g.updateSize()}),d.$emit('GoldenLayout_READY'))},h.wait_ready=()=>a(function(a){d.$on('GoldenLayout_READY',()=>{a()})}),h.createChild=(a)=>{g.root.contentItems[0].addChild(a)},h.createDragSource=(a,b)=>{g.createDragSource(a,b)},h}]).factory('layout_uid',function(){let a=0;return{get:()=>{let b=a++;return b}}});
angular.module('app.spinalcom').factory('authService',['$q','ngSpinalCore','config','$http',function(a,b,c,d){let e={},f={username:'',password:'',id:''},g=!1;e.save_user=(a,b,c)=>{f.username=a,f.password=b,f.id=c,window.localStorage.setItem('spinalhome_cfg',btoa(JSON.stringify(f)))},e.get_user=()=>{let a=window.localStorage.getItem('spinalhome_cfg');return a&&(f=JSON.parse(atob(a))),f},e.logout=()=>{''!=f.username&&(e.save_user('','',''),location.reload())},e.login=(f,j)=>{let k=a.defer();return d.get('/get_user_id'+'?u='+f+'&p='+j).then(function(a){var d=parseInt(a.data),l=0;if(-1==d){for(k.reject('Login Error: username / password pair not found.'),l=0;l<h.length;l++)h[l].reject();return void(h=[])}for(b.connect('http://'+d+':'+j+'@'+c.spinalhub_url+':'+c.spinalhub_port+'/'),e.save_user(f,j,d),g=!0,k.resolve(),l=0;l<h.length;l++)h[l].resolve();h=[]},function(){k.reject('Connection Error: Imposible to connect to the server.');for(var a=0;a<h.length;a++)h[a].reject();h=[]}),k.promise},e.is_Connected=()=>g;let h=[];return e.wait_connect=()=>{let b=a.defer();return!0==g?b.resolve():h.push(b),b.promise},e}]);
angular.module('app.controllers').controller('mainCtrl',['$scope','$routeParams','goldenLayoutService','spinalModelDictionary',function(a,b,c){c.init()}]);
angular.module('app.controllers').controller('navbarCtrl',['$scope','authService','$location','$routeParams',function(a,b,c,d){a.username='',a.connected=!1,b.wait_connect().then(()=>{a.username=b.get_user().username,a.connected=!0,a.viewer=d.filepath,a.viewer=a.viewer?atob(a.viewer):'viewer',console.log(d.filepath)}),a.logout=()=>{c.path('/login')},a.layouts=[{id:'drag-viewer',name:'viewer',cfg:{isClosable:!0,title:'viewer',type:'component',componentName:'SpinalHome',componentState:{template:'forgeviewer.html',controller:'forgeViewerCtrl'}}}]}]);
angular.module('app.spinalforge.plugin').controller('forgeViewerCtrl',['$scope','$rootScope','$mdDialog','authService','$compile','$injector','layout_uid','spinalModelDictionary',function(a,b,c,d,e,f,g,h){a.injector=f,a.uid=g.get(),console.log('forgeviewerCtrl start'),b.allNotes=[],b.allNotes=[{title:new Str('test1')},{title:new Str('test1')},{title:new Str('test1')},{title:new Str('test1')}],h.init().then(function(b){function c(){return h=g.bubble.search({type:'geometry',role:'3d'}),0===h.length?void console.error('Document contains no viewables.'):void g.selectItem(h[h.length-1].data,e,f)}function d(a){console.error('onDocumentLoadFailure() - errorCode:'+a)}function e(b){b.scope=a,console.log('Viewers are equal: '+(b===g.getCurrentViewer()))}function f(a){console.error('onItemLoadFail() - errorCode:'+a)}var g,h;console.log('forgeviewerCtrl start 2');var i={extensions:['PannelAnnotation','Autodesk.ADN.Viewing.Extension.Color']},j={env:'AutodeskProduction',accessToken:''},k='urn:'+b.urn.get();(function(a,b,c){a.oauth.set(''),a.ask_token.set(!0);var d=!0,e=function(){d&&''!=a.oauth.get()&&(d=!1,a.oauth.unbind(e),j.accessToken=a.oauth.get(),c(b))};a.oauth.bind(e)})(b,k,function(b){Autodesk.Viewing.Initializer(j,function(){g=new Autodesk.Viewing.ViewingApplication('MyViewerDiv'+a.uid),g.registerViewer(g.k3D,Autodesk.Viewing.Private.GuiViewer3D,i),g.loadDocument(b,c,d)})})})}]);
angular.module('app.controllers').controller('loginCtrl',['$scope','authService','$mdToast','$location',function(a,b,c,d){let e=c.simple().hideDelay(3e3),f=b.get_user();b.logout(),a.conf={email:'',password:''},a.ConnectBtn=()=>{b.login(a.conf.email,a.conf.password).then(()=>{d.path('/home')},(a)=>{e.textContent(a),c.show(e)})}}]);
angular.module("app.spinalforge.plugin").run(["spinalModelDictionary","$mdDialog","$mdToast","authService","$rootScope","$compile",function(a,b,c,d,e,f){Autodesk.Viewing.theExtensionManager.registerExtension("PannelAnnotation",class{constructor(a,b){Autodesk.Viewing.Extension.call(this,a,b),a.registerContextMenuCallback("rightClickMenu",(a)=>{a.push({title:"See Annotation",target:()=>{var a=this.viewer.getSelection();if(1==a.length){document.getElementById("search").value=a[0];var b=document.getElementById("allList");this.getContainer(a[0],(a)=>{this.changeContainer(b,a)})}else alert("you must select 1 item")}})}),e.notes_color={},this.viewer=a,this.panel=null,this.user=d.get_user(),this.detailPanelContent=null,this.detailPanel=null,this.filePanel=null,this.filePanelContent=null,this._selected=null,this._sel=null,this._file_selected=null,e.execute_func=(a,b,c=null)=>{"addItem"===a?this.AddItems(b):"changeColor"===a?this.changeColorInHub(b):"view"===a?this.viewOrHide(b):"rename"===a?this.renameNote(b):"delete"===a?this.deleteNoteItem(b,c):"info"===a?this.DetailPanel(b):"selectItem"===a?this.selectNote(b):"file"===a?this.DisplayFilePanel(b):"download"===a?this.DownloadFile(b):"delete_file"===a?this.RemoveFile(b):void 0}}load(){return this.viewer.toolbar?this.createUI():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),this.viewer.addEventListener(av.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)),!0}onToolbarCreated(){this.viewer.removeEventListener(av.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null,this.createUI()}unload(){return this.viewer.toolbar.removeControl(this.subToolbar),!0}createUI(){this.panel=new PanelClass(this.viewer,"Annotation"),this.initialize();var a=new Autodesk.Viewing.UI.Button("Annotation");a.onClick=()=>{this.panel.isVisible()?this.panel.setVisible(!1):this.panel.setVisible(!0)},a.addClass("fa"),a.addClass("fa-pencil"),a.addClass("fa-2x"),a.setToolTip("Annotation"),this.subToolbar=new Autodesk.Viewing.UI.ControlGroup("my-Annotation"),this.subToolbar.addControl(a),this.viewer.toolbar.addControl(this.subToolbar)}initialize(){this.panel.initializeMoveHandlers(this.panel.container),this.panel.container.appendChild(this.panel.createScrollContainer());var c=this.panel.container,d=(a)=>{var d=c,e=a;d.className+=" panelViewer";var f=document.createElement("div");f.className="_container";var g=document.createElement("div");g.className="header";var h=document.createElement("div");h.className="spin row head";var i=document.createElement("div");i.className="col-sm-3 col-md-3 col-xs-3";var j=document.createElement("button");j.className="btn btn-primary btn-sm btn-block",j.innerHTML="<i class=\"fa fa-pencil-square-o\" aria-hidden=\"true\"></i> Note",j.onclick=()=>{var a=b.prompt().title("New Note").placeholder("Please enter the title").ariaLabel("New Note").clickOutsideToClose(!0).required(!0).ok("Create!").cancel("Cancel");b.show(a).then((a)=>{this.AddNote(a)},function(){})};var k=document.createElement("div");k.className="col-sm-3 col-md-3 col-xs-3";var l=document.createElement("button");l.className="btn btn-primary btn-sm btn-block",l.innerHTML="<i class=\"fa fa-eye\" aria-hidden=\"true\"></i> View",l.onclick=()=>{this.changeAllItemsColor(),this.changeAllIcon("fa-eye-slash","true")};var m=document.createElement("div");m.className="col-sm-3 col-md-3 col-xs-3";var n=document.createElement("button");n.className="btn btn-primary btn-sm btn-block",n.innerHTML="<i class=\"fa fa-eye-slash\" aria-hidden=\"true\"></i> Hide",n.onclick=()=>{this.restoreAllItemsColor(),this.changeAllIcon("fa-eye","false")};var o=document.createElement("div");o.className="list-group allList",o.id="allList";var p=document.createElement("div");p.className="list-group allItems";var q=document.createElement("div");q.className="spin input-group";var r=document.createElement("span");r.className="icon input-group-addon",r.innerHTML="<i class=\"fa fa-search\" aria-hidden=\"true\"></i>";var s=document.createElement("input");s.className="input form-control toolbar-search-box",s.type="number",s.id="search",s.placeholder="item id",s.onclick=function(){s.focus()},s.oninput=()=>{""==s.value?this.changeContainer(o,e):this.getContainer(parseInt(s.value),(a)=>{this.changeContainer(o,a)})},i.appendChild(j),k.appendChild(l),m.appendChild(n),h.appendChild(i),h.appendChild(k),h.appendChild(m),g.appendChild(h),q.appendChild(r),q.appendChild(s),g.appendChild(q),f.appendChild(g),f.appendChild(o),f.appendChild(p),d.appendChild(f),e.bind(()=>{this.changeContainer(o,e)})};a.init().then((a)=>{a&&(a.annotationPlugin?a.annotationPlugin.load((a)=>{this.model=a,d(this.model)}):(this.model=new Lst,a.add_attr({annotationPlugin:new Ptr(this.model)}),d(this.model)))})}AddNote(a,b="#000000"){var c=this.model,d=newGUID(),e=new NoteModel;e.title.set(a),e.color.set(b),e.id.set(d),e.date.set(Date.now()),e.owner.set(this.user.id),e.username.set(this.user.username);var f=c;f.push(e),c.mod_attr(f)}AddItems(a){var b,d,e=this.viewer.getSelection(),f=this.model;return 0==e.length?void alert("No model selected !"):void this.viewer.model.getBulkProperties(e,{propFilter:["name"]},(e)=>{for(var g=0;g<f.length;g++)if(f[g].id==a){b=f[g].allObject,d=g;break}for(var h=0;h<e.length;h++)b.push(e[h]);f[d].allObject=b;var i=c.simple().content("Item added !").action("OK").highlightAction(!0).hideDelay(0).position("bottom right").parent("body");c.show(i)},function(){console.log("error")})}getContainer(a,b){var c=this.model,d=c.filter((b)=>0<b.allObject.filter((b)=>b.dbId.get()==a).length);b(d)}changeColorInHub(a,b){for(var c=this.model,d=0;d<c.length;d++)c[d].id==a&&c[d].color.set(b)}changeItemColor(a){for(var b,c=[],d=this.model,e=0;e<d.length;e++)if(d[e].id==a){b=d[e];for(var f=0;f<b.allObject.length;f++)c.push(b.allObject[f].dbId.get())}this.viewer.setColorMaterial(c,b.color.get(),b.id.get())}restoreColor(a){for(var b,c=[],d=this.model,e=0;e<d.length;e++)if(d[e].id==a){b=d[e];for(var f=0;f<b.allObject.length;f++)c.push(b.allObject[f].dbId.get())}this.viewer.restoreColorMaterial(c,a)}changeAllItemsColor(){for(var a=[],b=this.model,c=0;c<b.length;c++){for(var d,e=[],f=0;f<b[c].allObject.length;f++)e.push(b[c].allObject[f].dbId.get());d=b[c].color.get(),a.push({ids:e,color:d,id:b[c].id})}this.viewer.colorAllMaterials(a)}restoreAllItemsColor(){for(var a,b=[],c=this.model,d=0;d<c.length;d++){a=[];for(var e=0;e<c[d].allObject.length;e++)a.push(c[d].allObject[e].dbId.get());b.push({ids:a,id:c[d].id})}this.viewer.restoreAllMaterialColor(b)}deleteNoteItem(a,c=null){var d=this.model,e=b.confirm().ok("Delete !").title("Do you want to remove it?").cancel("Cancel").clickOutsideToClose(!0);b.show(e).then(()=>{if(null!=c){for(let e=0;e<d.length;e++)if(d[e].id==a)for(var b=0;b<d[e].allObject.length;b++)if(d[e].allObject[b].dbId==c){d[e].allObject.splice(b,1);break}}else for(let b=0;b<d.length;b++)if(d[b].id==a){d.splice(b,1);break}},function(){})}changeAllIcon(a,b){for(var c,d=this.model,e=0;e<d.length;e++)c=document.getElementsByClassName("show"+d[e].id)[0],c.innerHTML=`<i class="fa ${a}" aria-hidden="true"></i>`,c.setAttribute("show",b)}renameNote(a){var c=this.model,d=b.prompt().title("Rename Note").placeholder("Please enter the title").ariaLabel("Rename").clickOutsideToClose(!0).required(!0).ok("Rename").cancel("Cancel");b.show(d).then((b)=>{for(let d=0;d<c.length;d++)if(c[d].id==a){c[d].title.set(b);break}},function(){})}selectNote(a){var b=this.model;this._sel=a;var c=document.getElementsByClassName("allItems")[0];c.innerHTML="";var d=angular.element(c),g=angular.element("<div></div>"),h=angular.element("<md-list>      </md-list>");if(d.append(g),d.append(h),null!=a){for(let c=0;c<b.length;c++)if(b[c].id==a){var j=angular.element(`<h3>Note Selected : ${b[c].title.get()}</h3>`);if(g.append(j),0<b[c].allObject.length)for(let a=0;a<b[c].allObject.length;a++){var k=`
                  <md-list-item>
                    <p>${b[c].allObject[a].name.get()}</p>
        
                    <md-button class="i_btn" aria-label="delete_item" ng-click="execute_func('delete','${b[c].id.get()}','${b[c].allObject[a].dbId}')">
                      <i class="fa fa-trash" aria-hidden="true"></i>
                    </md-button>
                  </md-list-item>
                `;h.append(k)}else h.append("<h5>No item inside</h5>")}}else h.append("<h5>No item selected</h5>");f(g)(e),f(h)(e)}createitem(a,b,c){var d=`<md-list-item>
          <p class="noteTitle" ng-click="execute_func('selectItem','${b.id.get()}')">${b.title.get()}</p>

          <md-button class="i_btn" aria-label="add_item" id=${b.id.get()} ng-click="execute_func('addItem','${b.id.get()}')">
            <i class="fa fa-plus" aria-hidden="true"></i>
          </md-button>

          <!-- <input class="i_btn input_color" value="${b.color.get()}" id="i_color" type='color' name='${b.id.get()}' ng-change="execute_func('changeColor','${b.id.get()}')" ng-model="color${c}"/> -->
          <input class="i_btn input_color" value="${b.color.get()}" id="i_color" type='color' name='${b.id.get()}'/>

          <md-button class="i_btn show${b.id.get()}" id=${b.id.get()} aria-label="view" ng-click="execute_func('view','${b.id.get()}')" show="false">
            <i class="fa fa-eye" aria-hidden="true"></i>
          </md-button>

          <md-button class="i_btn" id=${b.id.get()} aria-label="rename" ng-click="execute_func('rename','${b.id.get()}')">
            <i class="fa fa-pencil" aria-hidden="true"></i>
          </md-button>

          <md-button class="i_btn" id=${b.id.get()} aria-label="delete" ng-click="execute_func('delete','${b.id.get()}')">
            <i class="fa fa-trash" aria-hidden="true"></i>
          </md-button>

          <md-button class="i_btn" id=${b.id.get()} aria-label="info" ng-click="execute_func('info','${b.id.get()}')">
            <i class="fa fa-comment" aria-hidden="true"></i>
          </md-button>

          <md-button class="i_btn" id=${b.id.get()} aria-label="info" ng-click="execute_func('file','${b.id.get()}')">
            <i class="fa fa-paperclip" aria-hidden="true"></i>
          </md-button>

        </md-list-item>`,g=angular.element(d);a.append(g),f(g)(e)}viewOrHide(a){var b=document.getElementsByClassName("show"+a)[0],c=b.getAttribute("show");"false"==c?(b.setAttribute("show","true"),this.changeItemColor(a),b.innerHTML="<i class=\"fa fa-eye-slash\" aria-hidden=\"true\"></i>"):(this.restoreColor(a),b.setAttribute("show","false"),b.innerHTML="<i class=\"fa fa-eye\" aria-hidden=\"true\"></i>")}changeContainer(a,b){a.innerHTML="";var c=this,d=angular.element(a),g=angular.element("<md-list>      </md-list>");if(d.append(g),f(g)(e),0<b.length)for(let a=0;a<b.length;a++){const c=b[a];this.createitem(g,c,a)}else g.append("<h1>No note created ! create one</h1>");this.selectNote(this._sel);var c=this,h=document.getElementsByClassName("input_color");for(let d=0;d<h.length;d++)h[d].onchange=function(){c.changeColorInHub(this.name,this.value)}}DetailPanel(a){var b=this.model;null==this.detailPanelContent&&(this.detailPanelContent=document.createElement("div"),this.detailPanelContent.className="content"),null==this.detailPanel&&(this.detailPanel=new PanelClass(this.viewer,a),this.detailPanel.initializeMoveHandlers(this.detailPanel.container),this.detailPanel.container.appendChild(this.detailPanel.createCloseButton()),this.detailPanel.container.style.right="0px",this.detailPanel.container.style.width="400px",this.detailPanel.container.style.height="600px",this.detailPanel.container.padding="0px");for(let c=0;c<b.length;c++)if(b[c].id==a){this._selected=b[c];break}var c=document.createElement("div");c.className="form_div";var d=document.createElement("div");d.className="textarea_div";var e=document.createElement("textarea");e.className="form-control",e.setAttribute("rows","2"),e.id=a,e.placeholder="add texte",e.onclick=()=>{e.focus()},d.appendChild(e);var f=document.createElement("div");f.className="send_button_div";var g=document.createElement("button");g.className="btn btn-block",g.textContent="Add",g.id=a,g.onclick=()=>{var a=document.querySelector(`textarea[id='${g.id}']`).value;if(document.querySelector(`textarea[id='${g.id}']`).value="",""!=a&&""!=a.trim()){var b=new MessageModel;b.id.set(newGUID()),b.owner.set(this.user.id),b.username.set(this.user.username),b.date.set(Date.now()),b.message.set(a),this._selected.notes.push(b)}},f.appendChild(g),c.appendChild(d),c.appendChild(f),this.detailPanel.setVisible(!0),b.bind(()=>{this.DisplayMessage(c)})}DisplayMessage(a){var c=this,e=document.createElement("div");e.className="messageContainer";for(let d=0;d<this._selected.notes.length;d++){var f=document.createElement("div");f.className="message_div";var g=document.createElement("div");g.className="_message";var h=document.createElement("div");h.className="message_owner",h.innerText=this._selected.notes[d].username.get();var j=document.createElement("div");j.className="message_date";var k=new Date(parseInt(this._selected.notes[d].date));j.innerText=k.getDate()+"/"+k.getMonth()+1+"/"+k.getFullYear();var l=document.createElement("div");l.className="message_content";var m=document.createElement("div");if(m.className="message_texte",m.innerHTML=this._selected.notes[d].message,this._selected.notes[d].owner==this.user.id){var n=document.createElement("div");n.className="close_div";var o=document.createElement("span");o.innerHTML="X",o.className="close",o.id=this._selected.notes[d].id,o.onclick=function(){var d=b.confirm().ok("Delete !").title("Do you want to remove it?").cancel("Cancel").clickOutsideToClose(!0);b.show(d).then(()=>{c.deteteMessage(this.id,a)},function(){})},n.appendChild(o),l.appendChild(n)}l.appendChild(m),g.appendChild(h),g.appendChild(l),f.appendChild(j),f.appendChild(g),e.appendChild(f)}this.detailPanelContent.innerHTML="",this.detailPanelContent.appendChild(e),this.detailPanelContent.appendChild(a),this.detailPanel.setTitle(this._selected.title.get()),this.detailPanel.container.appendChild(this.detailPanelContent);var i=document.getElementsByClassName("messageContainer")[0];i.scrollTop=i.scrollHeight}deteteMessage(a){for(let b=0;b<this._selected.notes.length;b++)if(this._selected.notes[b].id==a){this._selected.notes.splice(b,1);break}}DownloadFile(a){var b;for(let c=0;c<this._file_selected.files.length;c++)if(b=this._file_selected.files[c],b._info.id==a){b.load((a)=>{if(a instanceof Path){var c=document.createElement("a");c.setAttribute("href","/sceen/_?u="+a._server_id),c.setAttribute("download",b.name),c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)}});break}}RemoveFile(a){var c=b.confirm().ok("Delete !").title("Do you want to remove it?").cancel("Cancel").clickOutsideToClose(!0);b.show(c).then(()=>{for(let b=0;b<this._file_selected.files.length;b++)if(this._file_selected.files[b]._info.id==a){this._file_selected.files.splice(b,1);break}},function(){})}handle_files(a){var b;if(0<a.length)for(let c=0;c<a.length;c++)b=new Path(a[c]),this._file_selected.files.force_add_file(a[c].name,b,{id:newGUID()})}DisplayFilePanel(a){var b=this.model;if(null==this.filePanel){this.filePanel=new PanelClass(this.viewer,a),this.filePanel.initializeMoveHandlers(this.filePanel.container),this.filePanel.container.appendChild(this.filePanel.createCloseButton()),this.filePanel.container.style.right="0px",this.filePanel.container.style.width="400px",this.filePanel.container.style.height="600px",this.filePanel.container.padding="0px",this.filePanelContent=document.createElement("div"),this.filePanelContent.className="file_panel_content";var c=document.createElement("div");c.className="dragDrop";var d=document.createElement("input");d.type="file",d.id="modal-new-dropzone-input",d.setAttribute("multiple","true"),d.className="modal-new-dropzone-input",d.onchange=()=>this.handle_files(d.files);var e=document.createElement("label");e.innerHTML=`
                            <span class="modal-new-span-upload">
                              click to Choose files to upload or Drop them here
                            </span>
                            <ul id="modal-new-list-upload"></ul>`,e.className="text-center",e.ondrop=(a)=>{a.stopPropagation(),a.preventDefault(),this.handle_files(a.dataTransfer.files)},e.ondragover=(a)=>{a.preventDefault()},e.htmlFor="modal-new-dropzone-input",c.appendChild(d),c.appendChild(e),this.filePanelContent.appendChild(c);var f=document.createElement("div");f.className="files_div",this.filePanelContent.appendChild(f),this.filePanel.container.appendChild(this.filePanelContent)}this.filePanel.setVisible(!0);for(let c=0;c<b.length;c++)if(b[c].id==a){this._file_selected=b[c];break}this.filePanel.setTitle(this._file_selected.title.get()),b.bind(()=>{this.files_display()})}displayItem(a,b){var c=`<md-list-item>
                <p class="noteTitle">${a.name.get()}</p>

                <md-button class="i_btn" aria-label="add_item" id=${a._info.id.get()} ng-click="execute_func('delete_file','${a._info.id.get()}')">
                  <i class="fa fa-trash" aria-hidden="true"></i>
                </md-button>

                <md-button class="i_btn" aria-label="add_item" id=${a._info.id.get()} ng-click="execute_func('download','${a._info.id.get()}')">
                  <i class="fa fa-download" aria-hidden="true"></i>
                </md-button>
              </md-list-item>`,d=angular.element(c);b.append(d),f(d)(e)}files_display(){var a=document.getElementsByClassName("files_div")[0];a.innerHTML="";var b=angular.element(a),c=angular.element("<md-list>      </md-list>");b.append(c),f(c)(e);var d;for(let a=0;a<this._file_selected.files.length;a++)d=this._file_selected.files[a],this.displayItem(d,c)}})}]);

//# sourceMappingURL=app.compile.min.js.map