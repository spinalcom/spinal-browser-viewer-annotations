angular.module('app.route',['ngRoute']),angular.module('app.services',[]),angular.module('app.directives',[]),angular.module('app.controllers',[]),angular.module('app.spinalcom',['settings','ngMaterial']),angular.module('app.spinalforge.plugin',[]),angular.module('SpinalApp',['ngAnimate','ngMaterial','app.directives','app.route','app.services','app.controllers','ngMdIcons','settings','app.spinalcom','app.spinalforge.plugin']).run(['$rootScope','$location','authService',function(a,b,c){let d=c.get_user();a.$on('$routeChangeStart',function(a,e){e.$$route.authenticate&&!c.is_Connected()&&c.login(d.username,d.password).then(function(){},function(){b.path('/login')})})}]).config(['$mdThemingProvider',function(a){a.theme('altTheme').primaryPalette('grey',{default:'200'}).accentPalette('grey',{default:'700'}).dark(),a.theme('default').dark(),a.setDefaultTheme('altTheme'),a.alwaysWatchTheme(!0)}]).run(['$templateCache','$http',function(a,b){let c=(c,d)=>{b.get(c).then((b)=>{a.put(d,b.data)},()=>{console.log('Cannot load the file '+c)})},d=[{uri:'app/templates/forgeviewer.html',name:'forgeviewer.html'}];for(var e=0;e<d.length;e++)c(d[e].uri,d[e].name)}]);
angular.module('settings',[]).constant('config',{main_path:'/',spinalhub_url:'127.0.0.1',spinalhub_port:'8888',spinalhub_user:'168'});
angular.module("app.route").config(["$routeProvider","$locationProvider",function(a){a.when("/viewer/:filepath",{templateUrl:"app/templates/main.html",authenticate:!0,controller:"mainCtrl"}).when("/login",{templateUrl:"app/templates/login.html",authenticate:!1,controller:"loginCtrl"}).when("/404",{authenticate:!1,controller:["$location",function(a){a.replace("/drive/")}]}).otherwise({redirectTo:"/404"})}]);
angular.module('app.directives').directive('navbar',[function(){return{restrict:'E',templateUrl:'app/templates/navbar.html',controller:'navbarCtrl'}}]).directive('menuGlayout',['goldenLayoutService','$timeout',function(a){return{restrict:'E',scope:{layoutInfo:'=info'},replace:!0,template:'<li ng-repeat="layout in layoutInfo"  id="{{layout.id}}"><a >{{layout.name}}</a></li>',link:(b)=>{a.wait_ready().then(()=>{let c=(a,b)=>()=>{a.createChild(b.cfg)};for(var d=0;d<b.layoutInfo.length;d++){let e=b.layoutInfo[d];a.createDragSource($('#'+e.id)[0],e.cfg),$('#'+e.id).click(c(a,e))}})}}}]).directive('ngRightClick',['$parse',function(a){return function(b,c,d){var e=a(d.ngRightClick);c.bind('contextmenu',function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}]);
angular.module('app.spinalcom').factory('ngSpinalCore',['$q',function(a){var b={};return b.conn=0,b.connect=function(a){b.conn=spinalCore.connect(a)},b.store=function(c,d){var e=a.defer();return spinalCore.store(b.conn,c,d,function(a){e.resolve(a)},function(){e.reject()}),e.promise},b.load=function(c){var d=a.defer();return spinalCore.load(b.conn,c,function(a){d.resolve(a)},function(){d.reject()}),d.promise},b.load_type=function(c,d){var e=a.defer();return spinalCore.load_type(b.conn,c,d,function(a){e.resolve(a)},function(){e.reject()}),e.promise},b.load_right=function(c){var d=a.defer();return spinalCore.load_right(b.conn,c,function(a){d.resolve(a)},function(){d.reject()}),d.promise},b.share_model=function(a,c,d,e){return spinalCore.share_model(b.conn,a,c,d,e)},b}]);
angular.module('app.spinalcom').factory('spinalModelDictionary',['$q','ngSpinalCore','config','authService','$routeParams','$location',function(a,b,c,d,e,f){let g={};return g.model=0,g.init=()=>{var c=a.defer();return 0==g.model?d.wait_connect().then(()=>{let a=d.get_user(),h=e.filepath;console.log(h),h&&(h=atob(h),b.load(h).then((a)=>{g.model=a,console.log(a),c.resolve(a)},()=>{let a='not able to load : '+h;console.error(a),f.replace('/drive/'),c.reject(a)}))},()=>{let a='not able to load : '+path;console.error(a),f.replace('/drive/'),c.reject(a)}):c.resolve(g.model),c.promise},g}]);
angular.module('app.services').factory('goldenLayoutService',['$q','$window','$templateCache','$rootScope','$compile',function(a,b,c,d,e){var f={content:[{type:'row',content:[{isClosable:!1,title:'Viewer',type:'component',componentName:'SpinalHome',componentState:{template:'forgeviewer.html',controller:'forgeViewerCtrl'}}]}]};let g=0,h={};return h.init=()=>{0==g&&(g=new GoldenLayout(f,$('#g-layout')),g.registerComponent('SpinalHome',function(a,b){var f=a.getElement();''==b.template?(f.html(),e(f.contents())(d)):(f.html('<div class="gpannel-content" ng-controller="'+b.controller+'" ng-cloak>'+c.get(b.template)+'</div>'),e(f.contents())(d))}),g.init(),angular.element(b).bind('resize',function(){g.updateSize()}),d.$emit('GoldenLayout_READY'))},h.wait_ready=()=>a(function(a){d.$on('GoldenLayout_READY',()=>{a()})}),h.createChild=(a)=>{g.root.contentItems[0].addChild(a)},h.createDragSource=(a,b)=>{g.createDragSource(a,b)},h}]).factory('layout_uid',function(){let a=0;return{get:()=>{let b=a++;return b}}});
angular.module('app.spinalcom').factory('authService',['$q','ngSpinalCore','config','$http',function(a,b,c,d){let e={},f={username:'',password:'',id:''},g=!1;e.save_user=(a,b,c)=>{f.username=a,f.password=b,f.id=c,window.localStorage.setItem('spinalhome_cfg',btoa(JSON.stringify(f)))},e.get_user=()=>{let a=window.localStorage.getItem('spinalhome_cfg');return a&&(f=JSON.parse(atob(a))),f},e.logout=()=>{''!=f.username&&(e.save_user('','',''),location.reload())},e.login=(f,j)=>{let k=a.defer();return d.get('/get_user_id'+'?u='+f+'&p='+j).then(function(a){var d=parseInt(a.data),l=0;if(-1==d){for(k.reject('Login Error: username / password pair not found.'),l=0;l<h.length;l++)h[l].reject();return void(h=[])}for(b.connect('http://'+d+':'+j+'@'+c.spinalhub_url+':'+c.spinalhub_port+'/'),e.save_user(f,j,d),g=!0,k.resolve(),l=0;l<h.length;l++)h[l].resolve();h=[]},function(){k.reject('Connection Error: Imposible to connect to the server.');for(var a=0;a<h.length;a++)h[a].reject();h=[]}),k.promise},e.is_Connected=()=>g;let h=[];return e.wait_connect=()=>{let b=a.defer();return!0==g?b.resolve():h.push(b),b.promise},e}]);
angular.module('app.controllers').controller('mainCtrl',['$scope','$routeParams','goldenLayoutService','spinalModelDictionary',function(a,b,c){c.init()}]);
angular.module('app.controllers').controller('navbarCtrl',['$scope','authService','$location','$routeParams',function(a,b,c,d){a.username='',a.connected=!1,b.wait_connect().then(()=>{a.username=b.get_user().username,a.connected=!0,a.viewer=d.filepath,a.viewer=a.viewer?atob(a.viewer):'viewer',console.log(d.filepath)}),a.logout=()=>{c.path('/login')},a.layouts=[{id:'drag-viewer',name:'viewer',cfg:{isClosable:!0,title:'viewer',type:'component',componentName:'SpinalHome',componentState:{template:'forgeviewer.html',controller:'forgeViewerCtrl'}}}]}]);
angular.module('app.spinalforge.plugin').controller('forgeViewerCtrl',['$scope','$rootScope','$mdDialog','authService','$compile','$injector','layout_uid','spinalModelDictionary',function(a,b,c,d,e,f,g,h){a.injector=f,a.uid=g.get(),console.log('forgeviewerCtrl start'),h.init().then(function(b){function c(){return h=g.bubble.search({type:'geometry',role:'3d'}),0===h.length?void console.error('Document contains no viewables.'):void g.selectItem(h[h.length-1].data,e,f)}function d(a){console.error('onDocumentLoadFailure() - errorCode:'+a)}function e(a){console.log('Viewers are equal: '+(a===g.getCurrentViewer()))}function f(a){console.error('onItemLoadFail() - errorCode:'+a)}var g,h;console.log('forgeviewerCtrl start 2');var i={extensions:['PannelAnnotation','Autodesk.ADN.Viewing.Extension.Color']},j={env:'AutodeskProduction',accessToken:''},k='urn:'+b.urn.get();(function(a,b,c){a.oauth.set(''),a.ask_token.set(!0);var d=!0,e=function(){d&&''!=a.oauth.get()&&(d=!1,a.oauth.unbind(e),j.accessToken=a.oauth.get(),c(b))};a.oauth.bind(e)})(b,k,function(b){Autodesk.Viewing.Initializer(j,function(){g=new Autodesk.Viewing.ViewingApplication('MyViewerDiv'+a.uid),g.registerViewer(g.k3D,Autodesk.Viewing.Private.GuiViewer3D,i),g.loadDocument(b,c,d)})})})}]);
angular.module('app.controllers').controller('loginCtrl',['$scope','authService','$mdToast','$location',function(a,b,c,d){let e=c.simple().hideDelay(3e3),f=b.get_user();b.logout(),a.conf={email:'',password:''},a.ConnectBtn=()=>{b.login(a.conf.email,a.conf.password).then(()=>{d.path('/home')},(a)=>{e.textContent(a),c.show(e)})}}]);
angular.module("app.spinalforge.plugin").run(["spinalModelDictionary","$mdDialog","authService",function(a,b,c){Autodesk.Viewing.theExtensionManager.registerExtension("PannelAnnotation",class{constructor(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,a.registerContextMenuCallback("rightClickMenu",(a)=>{a.push({title:"See Annotation",target:()=>{var a=this.viewer.getSelection();if(1==a.length){document.getElementById("search").value=a[0];var b=document.getElementById("allList");this.getContainer(a[0],(a)=>{this.changeContainer(b,a)})}else alert("you must select 1 item")}})}),this.panel=null,this.user=c.get_user(),this.detailPanelContent=null,this.detailPanel=null,this._selected=null,console.log(this.user)}load(){return this.viewer.toolbar?this.createUI():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),this.viewer.addEventListener(av.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)),!0}onToolbarCreated(){this.viewer.removeEventListener(av.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null,this.createUI()}unload(){return this.viewer.toolbar.removeControl(this.subToolbar),!0}createUI(){this.panel=new PanelClass(this.viewer,"Annotation"),this.initialize();var a=new Autodesk.Viewing.UI.Button("Annotation");a.setIcon("fa-pencil"),a.onClick=()=>{this.panel.isVisible()?this.panel.setVisible(!1):this.panel.setVisible(!0)},a.addClass("Annotation"),a.setToolTip("Annotation"),this.subToolbar=new Autodesk.Viewing.UI.ControlGroup("my-Annotation"),this.subToolbar.addControl(a),this.viewer.toolbar.addControl(this.subToolbar)}initialize(){this.panel.initializeMoveHandlers(this.panel.container);var c=this.panel.container,d=(a)=>{var d=c,e=a;d.className+=" panelViewer";var f=document.createElement("div");f.className="spin row head";var g=document.createElement("div");g.className="col-sm-3 col-md-3 col-xs-3";var h=document.createElement("button");h.className="btn btn-primary btn-sm btn-block",h.innerHTML="<i class=\"fa fa-pencil-square-o\" aria-hidden=\"true\"></i> Note",h.onclick=()=>{var a=b.prompt().title("New Note").placeholder("Please enter the title").ariaLabel("New Note").clickOutsideToClose(!0).required(!0).ok("Create!").cancel("Cancel");b.show(a).then((a)=>{this.AddNote(a)},function(){})};var i=document.createElement("div");i.className="col-sm-3 col-md-3 col-xs-3";var j=document.createElement("button");j.className="btn btn-primary btn-sm btn-block",j.innerHTML="<i class=\"fa fa-eye\" aria-hidden=\"true\"></i> View",j.onclick=()=>{this.changeAllItemsColor(),this.changeAllIcon("fa-eye-slash",!0)};var k=document.createElement("div");k.className="col-sm-3 col-md-3 col-xs-3";var l=document.createElement("button");l.className="btn btn-primary btn-sm btn-block",l.innerHTML="<i class=\"fa fa-eye-slash\" aria-hidden=\"true\"></i> Hide",l.onclick=()=>{this.restoreAllItemsColor(),this.changeAllIcon("fa-eye",!1)};var m=document.createElement("div");m.className="list-group",m.id="allList";var n=document.createElement("div");n.className="spin input-group";var o=document.createElement("span");o.className="icon input-group-addon",o.innerHTML="<i class=\"fa fa-search\" aria-hidden=\"true\"></i>";var p=document.createElement("input");p.className="input form-control toolbar-search-box",p.type="number",p.id="search",p.placeholder="item id",p.onclick=function(){p.focus()},p.oninput=()=>{""==p.value?this.changeContainer(m,e):this.getContainer(parseInt(p.value),(a)=>{this.changeContainer(m,a)})},g.appendChild(h),i.appendChild(j),k.appendChild(l),f.appendChild(g),f.appendChild(i),f.appendChild(k),d.appendChild(f),n.appendChild(o),n.appendChild(p),d.appendChild(n),d.appendChild(m),e.bind(()=>{this.changeContainer(m,e)})};a.init().then((a)=>{a&&(a.annotationPlugin?a.annotationPlugin.load((a)=>{this.model=a,d(this.model)}):(this.model=new Lst,a.add_attr({annotationPlugin:new Ptr(this.model)}),d(this.model)))})}AddNote(a,b="#000000"){var c=this.model,d=newGUID(),e=new NoteModel;e.title.set(a),e.color.set(b),e.id.set(d),e.date.set(Date.now()),e.owner.set(this.user.id),e.username.set(this.user.username);var f=c;f.push(e),c.mod_attr(f)}AddItems(a){var b,c,d=this.viewer.getSelection(),e=this.model;return 0==d.length?void alert("No model selected !"):void this.viewer.model.getBulkProperties(d,{propFilter:["name"]},(d)=>{for(var f=0;f<e.length;f++)if(e[f].id==a){b=e[f].allObject,c=f;break}for(var g=0;g<d.length;g++)b.push(d[g]);e[c].allObject=b},function(){console.log("error")})}getContainer(a,b){var c=this.model,d=c.filter((b)=>0<b.allObject.filter((b)=>b.dbId.get()==a).length);b(d)}changeColorInHub(a,b){for(var c=this.model,d=0;d<c.length;d++)c[d].id==a&&c[d].color.set(b)}changeItemColor(a){for(var b,c=[],d=this.model,e=0;e<d.length;e++)if(d[e].id==a){b=d[e];for(var f=0;f<b.allObject.length;f++)c.push(b.allObject[f].dbId.get())}this.viewer.setColorMaterial(c,b.color.get(),b.id.get())}restoreColor(a){for(var b,c=[],d=this.model,e=0;e<d.length;e++)if(d[e].id==a){b=d[e];for(var f=0;f<b.allObject.length;f++)c.push(b.allObject[f].dbId.get())}this.viewer.restoreColorMaterial(c,a)}changeAllItemsColor(){for(var a=[],b=this.model,c=0;c<b.length;c++){for(var d,e=[],f=0;f<b[c].allObject.length;f++)e.push(b[c].allObject[f].dbId.get());d=b[c].color.get(),a.push({ids:e,color:d,id:b[c].id})}this.viewer.colorAllMaterials(a)}restoreAllItemsColor(){for(var a,b=[],c=this.model,d=0;d<c.length;d++){a=[];for(var e=0;e<c[d].allObject.length;e++)a.push(c[d].allObject[e].dbId.get());b.push({ids:a,id:c[d].id})}this.viewer.restoreAllMaterialColor(b)}deleteNoteItem(a,b=null){var c=this.model;if(null!=b){for(let e=0;e<c.length;e++)if(c[e].id==a)for(var d=0;d<c[e].allObject.length;d++)if(c[e].allObject[d].dbId==b){c[e].allObject.splice(d,1);break}}else for(let b=0;b<c.length;b++)if(c[b].id==a){c.splice(b,1);break}}changeAllIcon(a,b){for(var c,d=this.model,e=0;e<d.length;e++)c=document.getElementsByClassName("show"+d[e].id)[0],c.innerHTML=`<i class="fa ${a}" aria-hidden="true"></i>`,c.show=b}renameNote(a,b){var c=this.model;for(let d=0;d<c.length;d++)if(c[d].id==a){c[d].title.set(b);break}}changeContainer(a,c){a.innerHTML="";var d=this;if(0<c.length)for(var e=0;e<c.length;e++){var f=c[e],g=f.title.get(),h=f.id.get(),j=f.color.get(),k=document.createElement("div");k.className="card";var l=document.createElement("div");l.className="card-header row",l.setAttribute("role","tab"),l.id="headerNote"+e,l.innerHTML=`<div class="col-sm-4 col-md-4 col-xs-4">
                      <a href="javascript:;" data-toggle="collapse" data-target="#notes${e}" aria-expanded="true" aria-controls="notes${e}">${g}</a>
                  </div>`;var m=document.createElement("div");m.className="btn-group btn-group-lg";var n=document.createElement("button");n.className="btn",n.innerHTML="<i class=\"fa fa-plus\" aria-hidden=\"true\"></i>",n.title="Add item selected",n.id=h,n.onclick=function(){d.AddItems(this.id)};var o=document.createElement("input");o.className="btn",o.setAttribute("type","color"),o.value=j,o.title="change color",o.id=h,o.onchange=function(){d.changeColorInHub(this.id,this.value)};var p=document.createElement("button");p.className="btn show"+h,p.title="show all elements",p.innerHTML="<i class=\"fa fa-eye\" aria-hidden=\"true\"></i>",p.id=h,p.setAttribute("show",!1),p.onclick=function(){!0==this.show?(d.restoreColor(this.id),this.show=!1,this.innerHTML="<i class=\"fa fa-eye\" aria-hidden=\"true\"></i>"):(d.changeItemColor(this.id),this.show=!0,this.innerHTML="<i class=\"fa fa-eye-slash\" aria-hidden=\"true\"></i>")};var q=document.createElement("button");q.className="btn",q.title="rename",q.id=h,q.innerHTML="<i class=\"fa fa-pencil\" aria-hidden=\"true\"></i>",q.onclick=function(){var a=b.prompt().title("Rename Note").placeholder("Please enter the title").ariaLabel("Rename").clickOutsideToClose(!0).required(!0).ok("Rename").cancel("Cancel");b.show(a).then((a)=>{d.renameNote(this.id,a)},function(){})};var r=document.createElement("button");r.className="btn",r.title="delete",r.id=h,r.innerHTML="<i class=\"fa fa-trash\" aria-hidden=\"true\"></i>",r.onclick=function(){d.deleteNoteItem(this.id)};var s=document.createElement("button");s.className="btn",s.title="See detail",s.id=h,s.innerHTML="<i class=\"fa fa-info\" aria-hidden=\"true\"></i>",s.onclick=function(){d.DetailPanel(this.id)},m.appendChild(n),m.appendChild(o),m.appendChild(p),m.appendChild(q),m.appendChild(r),m.appendChild(s),l.appendChild(m);var t=document.createElement("div");t.id="notes"+e,t.className="collapse",t.setAttribute("role","tabpanel"),t.setAttribute("aria-labelledby","notes"+e),t.setAttribute("data-parent","#accordion");var u=document.createElement("div");u.className="card-body";var v=document.createElement("ul");v.className="list-group";var w,y=f.allObject.length;if(0<y)for(var x=0;x<y;x++){w=document.createElement("li"),w.className="list-group-item d-flex justify-content-between align-items-center",w.innerHTML=f.allObject[x].name;var i=document.createElement("button");i.className="btn badge",i.id=h+"/"+f.allObject[x].dbId,i.innerHTML="<i class=\"fa fa-trash-o\" aria-hidden=\"true\"></i>",i.onclick=()=>{var a=i.id.split("/");d.deleteNoteItem(a[0],a[1])},w.appendChild(i),v.appendChild(w)}else w=document.createElement("span"),w.innerText="No item",v.appendChild(w);u.appendChild(v),t.appendChild(u),k.appendChild(l),k.appendChild(t),a.appendChild(k)}else a.innerHTML="<h6>No item found</h6>"}DetailPanel(a){var b=this.model;null==this.detailPanelContent&&(this.detailPanelContent=document.createElement("div"),this.detailPanelContent.className="content"),null==this.detailPanel&&(this.detailPanel=new PanelClass(this.viewer,a),this.detailPanel.initializeMoveHandlers(this.detailPanel.container),this.detailPanel.container.appendChild(this.detailPanel.createCloseButton()),this.detailPanel.container.style.right="0px",this.detailPanel.container.style.width="400px",this.detailPanel.container.style.height="600px",this.detailPanel.container.padding="0px");for(let c=0;c<b.length;c++)if(b[c].id==a){this._selected=b[c];break}var c=document.createElement("div");c.className="form_div";var d=document.createElement("div");d.className="textarea_div";var e=document.createElement("textarea");e.className="form-control",e.setAttribute("rows","2"),e.id=a,e.placeholder="add texte",e.onclick=()=>{e.focus()},d.appendChild(e);var f=document.createElement("div");f.className="send_button_div";var g=document.createElement("button");g.className="btn btn-block",g.textContent="Add",g.id=a,g.onclick=()=>{var a=document.querySelector(`textarea[id='${g.id}']`).value;document.querySelector(`textarea[id='${g.id}']`).value="";var b=new MessageModel;b.id.set(newGUID()),b.owner.set(this.user.id),b.username.set(this.user.username),b.date.set(Date.now()),b.message.set(a),this._selected.notes.push(b)},f.appendChild(g),c.appendChild(d),c.appendChild(f),b.bind(()=>{this.DisplayMessage(c)})}DisplayMessage(a){var b=this,c=document.createElement("div");c.className="messageContainer";for(let d=0;d<this._selected.notes.length;d++){var e=document.createElement("div");e.className="message_div";var f=document.createElement("div");f.className="_message";var g=document.createElement("div");g.className="message_owner",g.innerText=this._selected.notes[d].username.get();var h=document.createElement("div");h.className="message_date";var j=new Date(parseInt(this._selected.notes[d].date));h.innerText=j.getDate()+"/"+j.getMonth()+1+"/"+j.getFullYear();var k=document.createElement("div");k.className="message_content";var l=document.createElement("div");if(l.className="message_texte",l.innerHTML=this._selected.notes[d].message,this._selected.notes[d].owner==this.user.id){var m=document.createElement("div");m.className="close_div";var n=document.createElement("span");n.innerHTML="X",n.className="close",n.id=this._selected.notes[d].id,n.onclick=function(){b.deteteMessage(this.id,a)},m.appendChild(n),k.appendChild(m)}k.appendChild(l),f.appendChild(g),f.appendChild(k),e.appendChild(h),e.appendChild(f),c.appendChild(e)}this.detailPanelContent.innerHTML="",this.detailPanelContent.appendChild(c),this.detailPanelContent.appendChild(a),this.detailPanel.setTitle(this._selected.title.get()),this.detailPanel.setVisible(!0),this.detailPanel.container.appendChild(this.detailPanelContent);var i=document.getElementsByClassName("messageContainer")[0];i.scrollTop=i.scrollHeight}deteteMessage(a){for(let b=0;b<this._selected.notes.length;b++)if(this._selected.notes[b].id==a){this._selected.notes.splice(b,1);break}}})}]);

//# sourceMappingURL=app.compile.min.js.map